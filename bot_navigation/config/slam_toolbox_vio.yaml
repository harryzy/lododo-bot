# ==============================================================================
# Slam Toolbox Configuration for VIO Mode / VIO 模式的 SLAM Toolbox 配置
# Optimized for use with visual odometry (rgbd_odometry + robot_localization)
# 为视觉里程计优化（rgbd_odometry + robot_localization）
# ==============================================================================

slam_toolbox:
  ros__parameters:
    # ==========================================================================
    # Simulation Time / 仿真时间
    # ==========================================================================
    use_sim_time: true
    
    # ==========================================================================
    # Frame Configuration / 坐标系配置
    # CRITICAL: When using EKF, odom frame is fused odometry
    # 关键：使用 EKF 时，odom 坐标系是融合里程计
    # ==========================================================================
    odom_frame: odom              # EKF fused odometry frame / EKF 融合里程计坐标系
    map_frame: map                # Map frame / 地图坐标系
    base_frame: base_link         # Robot base frame / 机器人基座坐标系
    
    # ==========================================================================
    # Input Configuration / 输入配置
    # ==========================================================================
    scan_topic: /scan             # Laser scan topic / 激光雷达话题
    
    # ==========================================================================
    # Mode Configuration / 模式配置
    # ==========================================================================
    mode: mapping                 # mapping or localization
    
    # ==========================================================================
    # Debug Configuration / 调试配置
    # ==========================================================================
    debug_logging: false
    
    # ==========================================================================
    # Scan Processing / 扫描处理
    # ==========================================================================
    
    # Throttle Scans / 扫描节流
    # Process every Nth scan (1 = process all)
    # 处理每第 N 个扫描（1 = 处理全部）
    throttle_scans: 1
    
    # Scan Queue Size / 扫描队列大小
    # CRITICAL for QoS compatibility
    # 对 QoS 兼容性至关重要
    scan_queue_size: 30
    
    # ==========================================================================
    # Transform Configuration / 变换配置
    # ==========================================================================
    
    # TF Timeout / TF 超时
    # Increased for VIO mode as visual odom may have delays
    # 为 VIO 模式增加，因为视觉里程计可能有延迟
    transform_timeout: 2.0
    
    # TF Buffer Duration / TF 缓冲持续时间
    tf_buffer_duration: 60.0
    
    # Transform Publish Period / 变换发布周期
    transform_publish_period: 0.05
    
    # ==========================================================================
    # Map Update Configuration / 地图更新配置
    # ==========================================================================
    
    # Map Update Interval / 地图更新间隔
    map_update_interval: 5.0
    
    # Map Resolution / 地图分辨率
    resolution: 0.05
    
    # ==========================================================================
    # Laser Range Configuration / 激光雷达范围配置
    # ==========================================================================
    
    # Maximum Laser Range / 最大激光范围
    max_laser_range: 8.0
    
    # Minimum Laser Range / 最小激光范围
    # Match depth_to_laserscan configuration
    # 匹配 depth_to_laserscan 配置
    min_laser_range: 0.1
    
    # ==========================================================================
    # Update Thresholds / 更新阈值
    # VIO mode: Can use more frequent updates due to better odometry
    # VIO 模式：由于更好的里程计，可以使用更频繁的更新
    # ==========================================================================
    
    # Minimum Travel Distance / 最小行驶距离
    # Lower threshold for more frequent updates
    # 更低的阈值以获得更频繁的更新
    minimum_travel_distance: 0.2
    
    # Minimum Travel Heading / 最小行驶航向
    # Lower threshold for more frequent updates
    # 更低的阈值以获得更频繁的更新
    minimum_travel_heading: 0.2
    
    # Minimum Time Interval / 最小时间间隔
    minimum_time_interval: 0.5
    
    # ==========================================================================
    # Scan Buffer Configuration / 扫描缓冲配置
    # ==========================================================================
    
    # Scan Buffer Size / 扫描缓冲大小
    scan_buffer_size: 10
    
    # Scan Buffer Maximum Distance / 扫描缓冲最大距离
    scan_buffer_maximum_scan_distance: 8.0
    
    # ==========================================================================
    # Loop Closure Configuration / 闭环检测配置
    # VIO mode: Can be more aggressive with loop closure
    # VIO 模式：可以更积极地进行闭环检测
    # ==========================================================================
    
    # Enable Loop Closure / 启用闭环检测
    do_loop_closing: true
    
    # Loop Search Maximum Distance / 闭环搜索最大距离
    loop_search_maximum_distance: 4.0
    
    # Loop Match Minimum Chain Size / 闭环匹配最小链大小
    loop_match_minimum_chain_size: 8
    
    # Loop Match Maximum Variance / 闭环匹配最大方差
    loop_match_maximum_variance_coarse: 3.0
    
    # Loop Match Minimum Response / 闘环匹配最小响应
    loop_match_minimum_response_coarse: 0.30
    loop_match_minimum_response_fine: 0.40
    
    # ==========================================================================
    # Scan Matching Configuration / 扫描匹配配置
    # ==========================================================================
    
    # Enable Scan Matching / 启用扫描匹配
    use_scan_matching: true
    
    # Use Scan Barycenter / 使用扫描质心
    use_scan_barycenter: true
    
    # Link Scan Maximum Distance / 链接扫描最大距离
    link_scan_maximum_distance: 1.5
    
    # Link Match Minimum Response / 链接匹配最小响应
    link_match_minimum_response_fine: 0.1
    
    # ==========================================================================
    # Correlation Search Space / 相关搜索空间
    # ==========================================================================
    
    # Search Space Dimension / 搜索空间尺寸
    correlation_search_space_dimension: 0.5
    
    # Search Space Resolution / 搜索空间分辨率
    correlation_search_space_resolution: 0.01
    
    # Search Space Smear Deviation / 搜索空间涂抹偏差
    correlation_search_space_smear_deviation: 0.1
    
    # ==========================================================================
    # Loop Search Space / 闭环搜索空间
    # ==========================================================================
    
    # Loop Search Space Dimension / 闭环搜索空间尺寸
    loop_search_space_dimension: 8.0
    
    # Loop Search Space Resolution / 闭环搜索空间分辨率
    loop_search_space_resolution: 0.05
    
    # Loop Search Space Smear Deviation / 闭环搜索空间涂抹偏差
    loop_search_space_smear_deviation: 0.03
    
    # ==========================================================================
    # Distance and Angle Penalties / 距离和角度惩罚
    # ==========================================================================
    
    # Distance Variance Penalty / 距离方差惩罚
    distance_variance_penalty: 0.5
    
    # Angle Variance Penalty / 角度方差惩罚
    angle_variance_penalty: 1.0
    
    # Fine Search Angle Offset / 精细搜索角度偏移
    fine_search_angle_offset: 0.00349
    
    # Coarse Search Angle Offset / 粗糙搜索角度偏移
    coarse_search_angle_offset: 0.349
    
    # Coarse Angle Resolution / 粗糙角度分辨率
    coarse_angle_resolution: 0.0349
    
    # Minimum Angle Penalty / 最小角度惩罚
    minimum_angle_penalty: 0.9
    
    # Minimum Distance Penalty / 最小距离惩罚
    minimum_distance_penalty: 0.5
    
    # Use Response Expansion / 使用响应扩展
    use_response_expansion: true
    
    # ==========================================================================
    # Interactive Mode / 交互模式
    # ==========================================================================
    enable_interactive_mode: true
    
    # ==========================================================================
    # Stack Size / 堆栈大小
    # For Ceres solver on large maps
    # 用于大地图上的 Ceres 求解器
    # ==========================================================================
    stack_size_to_use: 40000000
